### Протоколы сетевого уровня IPv4 и IPv6.
IPv4 и IPv6 - виды протокола IP.

### Заголовок пакета IPv4 и IPv6. Поля заголовков IPv4 и IPv6.
Заголовок пакета IPv4 состоит из нескольких полей, включающих важную информацию о пакете. Эти поля содержат двоичные числа, которые анализируются процессом уровня 3.
Двоичные значения каждого поля определяют различные параметры IP-пакета. Схемы заголовков протокола, считываемые слева направо и сверху вниз, предоставляют наглядную информацию о полях протоколов. Схема заголовков IP-протокола на рисунке определяет поля IPv4-пакета.
![[Pasted image 20250106000300.png]]
Среди наиболее важных полей в заголовке IPv4 можно выделить следующие:
- **Версия. -** Содержит 4-битное двоичное значение, определяющее версию IP-пакета. Для пакетов IPv4 в этом поле всегда указано значение 0100.
- **Дифференцированные сервисы (Differentiated Services, DS). -** Поле, которое ранее называлось «Тип сервиса» (Type of Service, ToS). DS —это 8-битное поле, используемое для определения приоритета каждого пакета. 6 наиболее важных битов поля дифференцированных услуг (DSCP) и последние 2 бита — это биты явного уведомления о заторах (ECN).
- **Контрольная сумма заголовка** - используется для обнаружения повреждения в заголовке IPv4.
- **Время существования (Time-to-Live, TTL).** Содержит 8-битное двоичное значение, используемое для ограничения времени существования пакета. Отправитель пакета устанавливает начальное значение времени существования (TTL), которое уменьшается на единицу каждый раз при обработке пакета маршрутизатором. Если значение в поле TTL уменьшается до нуля, маршрутизатор отбрасывает пакет и отправляет на IP-адрес источника сообщение о превышении времени протокола ICMP (управление сообщениями в сети). Поскольку маршрутизатор уменьшает TTL каждого пакета, маршрутизатор также должен пересчитать контрольную сумму заголовка.
- **Протокол. –** Это поле используется для определения протокола следующего уровня. Это 8-битное двоичное значение, указывающее тип полезной нагрузки данных, которые переносит пакет, что позволяет сетевому уровню пересылать данные на соответствующий протокол более высокого уровня. Обычно используются значения ICMP (1), TCP (6) и UDP (17).
- **IPv4-адрес источника. -** Содержит 32-битное двоичное значение, которое представляет IPv4-адрес источника пакета. IPv4-адрес источника — это всегда индивидуальный адрес.
- **IPv4-адрес назначения. –** Содержит 32-битное двоичное значение, которое представляет IPv4-адрес назначения пакета. IPv4-адрес назначения — одноадресная рассылка, многоадресная рассылка, или широковещательный адрес.

##### IPv6
Одним из основных конструктивных улучшений протокола IPv6 по сравнению с IPv4 является упрощенный заголовок IPv6.

Например, заголовок IPv4 состоит из 20 октетов (до 60 байт, если используется поле «Параметры») и 12 основных полей заголовка, не учитывая поля «Параметры» и «Заполнитель».
![[Pasted image 20250106000546.png]]

Поля в заголовке пакета IPv6:
- **Версия. -** Это поле содержит 4-битное двоичное значение, которое определяет версию IP-пакета. Для пакетов IPv6 в этом поле всегда указано значение 0110.
- **Класс трафика.-** Это 8-битное поле, соответствующее полю «Дифференцированные услуги (DS)» в заголовке IPv4.
- **Метка потока. -** Это 20-битное поле указывает на то, что всем пакетам с одинаковыми метками потока назначается одинаковый тип обработки маршрутизаторами.
- **Длина полезной нагрузки. -** Это 16-битное поле указывает длину блока данных или полезной нагрузки пакета IPv6. Это не включает длину заголовка IPv6, который является фиксированным 40-байтным заголовком.
- **Следующий заголовок.-** Это 8-битное поле, соответствующее полю «Протокол» в заголовке IPv4. Оно указывает тип полезной нагрузки данных, которые переносит пакет, что позволяет сетевому уровню пересылать данные на соответствующий протокол более высокого уровня.
- **Предел перехода.** - Это 8-битное поле, заменяющее поле «Время существования» (TTL) в IPv4. Это значение уменьшается на единицу каждым маршрутизатором, пересылающим пакет. Когда счетчик достигает значения 0, пакет отбрасывается и на отправляющий узел пересылается сообщение ICMPv6, которое означает, что пакет не достиг своего назначения, так как был превышен предел переходов. В отличие от IPv4, IPv6 не включает контрольную сумму заголовка IPv6, так как эта функция выполняется как на нижнем, так и на верхнем уровнях. Это означает, что контрольную сумму не нужно пересчитывать каждым маршрутизатором при уменьшении поля Hop Limit, что также повышает производительность сети.
- **IPv6-адрес источника. -** Это 128-битное поле, определяющее IPv6-адрес хоста-отправителя.
- **IPv6-адрес назначения.-** Это 128-битное поле, определяющее IPv6-адрес хоста-получателя.


### Маршрутизация.
Маршрутизация — это процесс определения наилучшего пути к узлу назначения. Маршрутизатор, подключённый к сегменту локальной сети, называется шлюзом по умолчанию.

На узлах должна храниться их собственная локальная таблица маршрутизации, чтобы пакеты сетевого уровня гарантированно направлялись в нужную сеть назначения.
Как правило, локальная таблица узла  одержит следующие данные:
- прямое подключение - маршрут к интерфейсу loopback (127.0.0.1)
- маршрут локальной сети - информация о сети, к которой подключён узел, автоматически добавляется в таблицу маршрутизации узла
- локальный маршрут по умолчанию - это маршрут, который должны пройти пакеты, чтобы достичь всех удалённых сетевых адресов
### Методы маршрутизации узлов. 
**Статические маршруты** - это записи маршрутов, которые настраиваются вручную. Статический маршрут включает в себя адрес удаленной сети и IP-адрес маршрутизатора следующего перехода. В случае изменения топологии сети статический маршрут не обновляется автоматически и должен быть перенастроен вручную.

Типы: 
- Стандартный статический маршрут 
- Статический маршрут по умолчанию 
- Плавающий статический маршрут
- Суммарный статический маршрут

Протокол **динамической маршрутизации** позволяет маршрутизаторам автоматически получать информацию о удаленных сетях, включая маршрут по умолчанию, от других маршрутизаторов. Маршрутизаторы, использующие протоколы динамической маршрутизации, автоматически обмениваются информацией о маршрутизации с другими маршрутизаторами и выполняют обновления в случае каких-либо изменений в топологии без участия сетевого администратора. При изменении топологии сети маршрутизаторы совместно используют эту информацию с помощью протокола динамической маршрутизации и автоматически обновляют свои таблицы маршрутизации.
Протоколы динамической маршрутизации включают OSPF и расширенный протокол маршрутизации внутреннего шлюза (EIGRP).
### Таблицы маршрутизации
Таблица маршрутизации маршрутизатора содержит записи сетевого маршрута, перечисляющие все возможные известные сетевые назначения.

В таблице маршрутизации хранятся три типа записей маршрута:

- **Сети с прямым подключением (Directly-connected networks)-** эти записи сетевого маршрута являются активными интерфейсами маршрутизатора. Маршрутизаторы добавляют маршрут с прямым подключением, когда интерфейс настроен с IP-адресом и активирован. Каждый из интерфейсов маршрутизатора подключен к разному сегменту сети. На рисунке сети с прямым подключением в таблице маршрутизации R1 IPv4 будут иметь значения 192.168.10.0/24 и 209.165.200.224/30.
- **Удаленные сети** — это сети, подключенные к другим маршрутизаторам. Маршрутизаторы узнают о удаленных сетях либо путем явной настройки администратором, либо путем обмена информацией о маршрутах с помощью протокола динамической маршрутизации. На рисунке удаленная сеть в таблице маршрутизации R1 IPv4 будет иметь значение 10.1.1.0/24.
- **Маршрут по умолчанию** — как и узел, большинство маршрутизаторов также включают запись маршрута по умолчанию, в качестве последнего средства, если иного маршрута до нужной сети в таблице маршрутизации нет. Маршрут по умолчанию используется, если в таблице IP-маршрутизации нет лучшего (наибольшего) соответствия. На рисунке таблица маршрутизации R1 IPv4, скорее всего, будет включать маршрут по умолчанию для пересылки всех пакетов маршрутизатору R2.
### Настройка маршрутизатора Cisco
Настройка статических маршрутов IPv4 выполняется с помощью команды ip route: 
`Router(config)# ip route network-address subnetmask { ip-address | exit-intf [ip-address]} [distance]`

Наряду с командами show ip route, show ipv6 route, ping и traceroute, для проверки статических маршрутов также используются следующие команды: 
- show ip route static 
- show ip route network 
- show running-config | section ip route