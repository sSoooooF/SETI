### Транспортный уровень. Протоколы транспортного уровня.
в вопросе №8 (TCP, UDP)

### Надежность и управление потоком.
Причина, по которой TCP является лучшим протоколом для некоторых приложений, заключается в том, что, в отличие от UDP, он повторно отправляет отброшенные пакеты и нумерует пакеты, чтобы указать их правильный порядок перед доставкой.

Могут быть случаи, когда сегменты TCP не приходят к месту назначения. В других случаях сегменты TCP могут поступать в неправильном порядке. Для того чтобы получатель смог расшифровать изначальное сообщение, данные в этих сегментах повторно собираются в исходном порядке. Для этого в заголовке каждого пакета указываются порядковые номера. Порядковый номер соответствует порядковому номеру первого байта данных сегмента TCP.

Во время настройки сеанса связи задается начальный порядковый номер сеанса (ISN). Этот номер ISN представляет собой стартовое значение счётчика байт, переданных удалённому приложению. По мере передачи данных во время сеанса порядковый номер увеличивается на число переданных байтов. Такое отслеживание байтов данных позволяет однозначно определять и подтверждать каждый сегмент. Можно выяснить, какие сегменты отсутствуют.

Независимо от того, насколько хорошо разработана сеть, иногда происходит потеря данных. Протокол TCP обеспечивает возможности для управления потерянными сегментами. Среди них — механизм повторной передачи сегментов с данными, получение которых не было подтверждено.


Протокол TCP обеспечивает механизмы для управления потоком данных. **Управление потоком данных** - это объем данных, которые получатель может получить и надежно обработать. Управление потоком позволяет поддерживать надежность передачи по протоколу TCP, регулируя скорость потока данных между узлами источника и назначения в течение определенного сеанса. Для этого, в заголовке TCP имеется 16-битное поле, которое называется размером окна.
![[Pasted image 20250107190909.png]]
Размер окна определяет количество байтов, которые могут быть отправлены до ожидания подтверждения. Номер подтверждения — номер следующего ожидаемого байта.

Размер окна — это количество байтов, которое устройство назначения способно принять и обработать за один раз во время сеанса TCP. В этом примере первоначальный размер окна узла PC B для представленного сеанса TCP установлен равным 10 000 байт. Начиная с первого байта (с порядковым номером 1), последним байтом, который узел PC A может отправить без получения подтверждения, будет 10 000-й байт. Это называется окном отправки ПК А. Размер окна включен в каждый сегмент TCP, поэтому получатель может изменить размер окна в любое время в зависимости от доступности буфера.
![[Pasted image 20250107191005.png]]
На рисунке источник передает 1460 байт данных в каждом сегменте. Обычно это максимальный размер сегмента (MSS), который может получить конечное устройство. MSS является частью поля параметров в заголовке TCP, который определяет наибольший объем данных в байтах, которые устройство может получить в одном сегменте TCP. Размер MSS не включает заголовок TCP. MSS обычно включается во время трехстороннего рукопожатия.

Обычный MSS составляет 1 460 байт при использовании IPv4. Узел определяет значение своего поля MSS путем вычитания размера заголовков IP и TCP из размера MTU для Ethernet. На интерфейсе Ethernet размер MTU по умолчанию равен 1500 байт. Если вычесть заголовок IPv4 размером 20 байт и заголовок TCP размером 20 байт, то размер MSS по умолчанию будет равен 1460 байт, как показано на рисунке.![[Pasted image 20250107191046.png]]

В случае возникновения перегрузки в сети перегруженный маршрутизатор перестает обрабатывать пакеты. Когда пакеты с сегментами TCP не доходят до своего узла назначения, они не подтверждаются. Определив скорость передачи данных, при которой сегменты TCP отправляются, но не подтверждаются, узел источника может примерно определить уровень загруженности сети.

В случае перегрузки происходит повторная передача потерянных сегментов TCP с узла источника. При отсутствии должного контроля над повторной передачей подобная отправка потерянных сегментов TCP может только ухудшить ситуацию. Помимо отправки в сеть новых пакетов с сегментами TCP возникает эффект обратной связи, когда переданные повторно потерянные сегменты TCP еще больше перегружают сеть. Во избежание таких ситуаций и для предотвращения перегрузок сети в протоколе TCP предусмотрен ряд соответствующих механизмов, таймеров и алгоритмов.

### Обмен данными с использованием UDP.
UPD идеально подходит для связи, которая должна быть быстрой, например VoIP.
Как и в случае с сегментами TCP, когда на узел назначения отправляются датаграммы UDP, они могут использовать разные пути и прибыть в неправильном порядке. Протокол UDP не отслеживает порядковые номера, как это делает протокол TCP.
Протокол UDP просто повторно собирает данные в том порядке, в котором они были приняты, и пересылает их приложению. Если последовательность данных важна для работы приложения, оно должно определить правильную последовательность и выбрать оптимальный способ обработки данных.
Серверным приложениям на основе протокола UDP присваиваются известные или зарегистрированные номера портов. Когда эти приложения или процессы запущены на сервере, они принимают данные, совпадающие с присвоенным номером порта. Если UDP получает датаграмму, адресованную одному из этих портов, он пересылает данные приложения соответствующему приложению, исходя из его номера порта.

